---
source: crates/runtime/tests/models/openai.rs
expression: "sql_to_display(&rt,\nformat!(r#\"SELECT input\n                FROM runtime.task_history\n                WHERE start_time >= '{}'\n                AND task='ai_completion'\n                ORDER BY start_time\n                LIMIT 1;\n            \"#,\nInto::<DateTime<Utc>>::into(task_start_time).to_rfc3339()).as_str()).await.expect(\"Failed to execute HTTP SQL query\")"
---
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| input                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| {"messages":[{"role":"assistant","tool_calls":[{"id":"initial_list_datasets","type":"function","function":{"name":"list_datasets","arguments":""}}]},{"role":"tool","content":"[{\"table\":\"spice.public.taxi_trips\",\"can_search_documents\":false,\"description\":null,\"metadata\":{}},{\"table\":\"spice.public.item\",\"can_search_documents\":true,\"description\":null,\"metadata\":{}}]","tool_call_id":"initial_list_datasets"},{"role":"system","content":"You are an assistant that responds to queries by providing only the requested data values without extra explanation."},{"role":"user","content":"Provide the total number of records in the taxi trips dataset. If known, return a single numeric value."}],"model":"","tools":[{"type":"function","function":{"name":"document_similarity","description":"Search and retrieve documents from available datasets","parameters":{"$schema":"http://json-schema.org/draft-07/schema#","title":"SearchRequestJson","type":"object","required":["text"],"properties":{"additional_columns":{"description":"Additional columns to return from the dataset.","default":[],"type":"array","items":{"type":"string"}},"datasets":{"description":"The datasets to search for similarity. If None, search across all datasets. For available datasets, use the `list_datasets` tool and ensure `can_search_documents==true`.","default":null,"type":["array","null"],"items":{"type":"string"}},"limit":{"description":"Number of documents to return for each dataset","default":null,"type":["integer","null"],"format":"uint","minimum":0.0},"text":{"description":"The text to search documents for similarity","type":"string"},"where":{"description":"An SQL filter predicate to apply. Format: 'WHERE `where_cond`'.","default":null,"type":["string","null"]}}}}},{"type":"function","function":{"name":"get_readiness","description":"Retrieves the readiness status of all runtime components including registered datasets, models, and embeddings."}},{"type":"function","function":{"name":"list_datasets","description":"List all SQL tables available."}},{"type":"function","function":{"name":"random_sample","description":"Sample random rows from a table.","parameters":{"$schema":"http://json-schema.org/draft-07/schema#","title":"RandomSampleParams","type":"object","required":["dataset","limit"],"properties":{"dataset":{"description":"The SQL dataset to sample data from.","type":"string"},"limit":{"description":"The number of rows, each with distinct values per column, to sample.","type":"integer","format":"uint","minimum":0.0}}}}},{"type":"function","function":{"name":"sample_distinct_columns","description":"Generate synthetic data by sampling distinct column values from a table.","parameters":{"$schema":"http://json-schema.org/draft-07/schema#","title":"DistinctColumnsParams","type":"object","required":["dataset","limit"],"properties":{"cols":{"description":"The columns to sample distinct values from. If None, all columns are sampled.","type":["array","null"],"items":{"type":"string"}},"dataset":{"description":"The SQL dataset to sample data from.","type":"string"},"limit":{"description":"The number of rows, each with distinct values per column, to sample.","type":"integer","format":"uint","minimum":0.0}}}}},{"type":"function","function":{"name":"sql","description":"Run an SQL query on the data source. Columns with capitals must be quoted. When needed quote each part of catalog.schema.table: \"catalog\".\"schema\".\"table\". Avoid 'SELECT *', and columns with `_offset` or `_embedding` suffix.","parameters":{"$schema":"http://json-schema.org/draft-07/schema#","title":"SqlToolParams","type":"object","required":["query"],"properties":{"query":{"description":"The SQL query to run. Double quote all select columns and never select columns ending in '_embedding'. The `table_catalog` is 'spice'. Always use it in the query","type":"string"}}}}},{"type":"function","function":{"name":"table_schema","description":"Retrieve the schema of all available SQL tables","parameters":{"$schema":"http://json-schema.org/draft-07/schema#","title":"TableSchemaToolParams","type":"object","required":["tables"],"properties":{"output":{"description":"If `full` return metadata and semantic details about the columns.","default":"full","allOf":[{"$ref":"#/definitions/OutputType"}]},"tables":{"description":"Which subset of tables to return results for. Default to all tables.","type":"array","items":{"type":"string"}}},"definitions":{"OutputType":{"type":"string","enum":["full","minimal"]}}}}},{"type":"function","function":{"name":"top_n_sample","description":"Sample the top N rows from a table based on a specified ordering","parameters":{"$schema":"http://json-schema.org/draft-07/schema#","title":"TopSamplesParams","type":"object","required":["dataset","limit","order_by"],"properties":{"dataset":{"description":"The SQL dataset to sample data from.","type":"string"},"limit":{"description":"The number of rows, each with distinct values per column, to sample.","type":"integer","format":"uint","minimum":0.0},"order_by":{"description":"How to order the samples before retrieving the top N.","type":"string"}}}}}]} |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
